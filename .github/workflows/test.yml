name: "Tests"

# If you modify more test jobs, ensure that you add them as required to the job "confirmTestPassed"
# which is located at the end of this file (more info in the job)

on:
  push:
    branches: ["main", "release-*"]
  pull_request:
  workflow_dispatch:

env:
  FRAME_OMNI_BENCHER_RELEASE_VERSION: polkadot-stable2506

# cancel previous runs
concurrency:
  group: ${{ github.workflow }}-${{ github.event.pull_request.number || github.ref }}
  cancel-in-progress: true

jobs:
  # This generates a matrix with all the required jobs which will be run in the next step
  runtime-matrix:
    runs-on: ubuntu-24.04
    outputs:
      runtime: ${{ steps.runtime.outputs.runtime }}
    name: Extract runtimes from matrix
    steps:
      - uses: actions/checkout@v4
      - id: runtime
        run: |
          TASKS=$(echo $(cat .github/workflows/runtimes-matrix.json) | sed 's/ //g' )
          echo $TASKS
          echo "runtime=$TASKS" >> $GITHUB_OUTPUT

  integration-test-matrix:
    runs-on: ubuntu-24.04
    outputs:
      itest: ${{ steps.itest.outputs.itest }}
    name: Extract integration tests from matrix
    steps:
      - uses: actions/checkout@v4
      - id: itest
        run: |
          TASKS=$(echo $(cat .github/workflows/integration-tests-matrix.json) | sed 's/ //g' )
          echo $TASKS
          echo "itest=$TASKS" >> $GITHUB_OUTPUT

  # Job required by "confirmTestPassed"
  runtime-test:
    needs: [runtime-matrix]
    runs-on: self-hosted
    strategy:
      matrix:
        runtime: ${{ fromJSON(needs.runtime-matrix.outputs.runtime) }}
    steps:
      - name: Free Disk Space (Ubuntu)
        if: ${{ runner.environment == 'github-hosted' }}
        uses: jlumbroso/free-disk-space@54081f138730dfa15788a46383842cd2f914a1be # v1.3.1
        with:
          tool-cache: false

      - name: Checkout
        uses: actions/checkout@v4

      - name: Install updates and dependencies
        run: .github/install-deps.sh

      - name: Set rust version via common env file
        run: cat .github/env >> $GITHUB_ENV

      - name: Install stable toolchain
        uses: dtolnay/rust-toolchain@master
        with:
          targets: "wasm32v1-none"
          components: "rust-src"
          toolchain: "${{env.RUST_STABLE_VERSION}}"

      - name: Fetch cache
        uses: Swatinem/rust-cache@f0deed1e0edfc6a9be95417288c0e1099b1eeec3 # v2.7.7
        with:
          shared-key: "fellowship-cache-runtime-tests"
          save-if: ${{ github.ref == 'refs/heads/main' }}

      - name: Download frame-omni-bencher
        run: |
          curl --max-time 10 --retry 5 --retry-delay 10 --retry-max-time 120 -sL https://github.com/paritytech/polkadot-sdk/releases/download/$FRAME_OMNI_BENCHER_RELEASE_VERSION/frame-omni-bencher -o frame-omni-bencher
          chmod +x ./frame-omni-bencher
          ./frame-omni-bencher --version
        shell: bash

      - name: Test ${{ matrix.runtime.name }}
        run: |
          if [ -n "${{ matrix.runtime.build_extra_features }}" ]; then
            cargo test -p ${{ matrix.runtime.package }} --release --locked -q --features ${{ matrix.runtime.build_extra_features }}
          else
            cargo test -p ${{ matrix.runtime.package }} --release --locked -q
          fi
        env:
          RUSTFLAGS: "-C debug-assertions -A warnings" # FAIL-CI AHM

      - name: Test all features ${{ matrix.runtime.name }}
        run: cargo test -p ${{ matrix.runtime.package }} --release --locked -q --all-features
        env:
          RUSTFLAGS: "-C debug-assertions -A warnings" # FAIL-CI AHM
          SKIP_WASM_BUILD: 1
          WS: ${{ matrix.runtime.uris[0] }}
          RUST_LOG: "remote-ext=info"

      - name: Test benchmarks ${{ matrix.runtime.name }}
        run: |
          PACKAGE_NAME=${{ matrix.runtime.package }}
          RUNTIME_BLOB_NAME=$(echo $PACKAGE_NAME | sed 's/-/_/g').compact.compressed.wasm
          RUNTIME_BLOB_PATH=./target/production/wbuild/$PACKAGE_NAME/$RUNTIME_BLOB_NAME
          # build wasm
          echo "Preparing wasm for benchmarking RUNTIME_BLOB_PATH=$RUNTIME_BLOB_PATH"
          if [ -n "${{ matrix.runtime.build_extra_features }}" ]; then
            cargo build --profile production -p ${{ matrix.runtime.package }} --features=runtime-benchmarks,${{ matrix.runtime.build_extra_features }} -q --locked
          else
            cargo build --profile production -p ${{ matrix.runtime.package }} --features=runtime-benchmarks -q --locked
          fi
          # run benchmarking
          if [ -z "${{ matrix.runtime.benchmarks_exclude_extrinsics }}" ]; then
            EXCLUDE_EXTRINSICS=""
          else
            EXCLUDE_EXTRINSICS_JSON='${{ toJson(matrix.runtime.benchmarks_exclude_extrinsics) }}'
            EXCLUDE_EXTRINSICS_LIST=$(echo "$EXCLUDE_EXTRINSICS_JSON" | jq -r 'to_entries | map("\(.key)::\(.value[])") | join(" ")')
            EXCLUDE_EXTRINSICS=" --exclude-extrinsics ${EXCLUDE_EXTRINSICS_LIST}"
          fi
          echo "Running benchmarking for RUNTIME_BLOB_PATH=$RUNTIME_BLOB_PATH $EXCLUDE_EXTRINSICS"
          ./frame-omni-bencher v1 benchmark pallet --runtime $RUNTIME_BLOB_PATH --all --steps 2 --repeat 1 $EXCLUDE_EXTRINSICS --heap-pages 4096
        env:
          RUSTFLAGS: "-C debug-assertions -A warnings" # FAIL-CI AHM

  # Job required by "confirmTestPassed"
  integration-test:
    needs: [integration-test-matrix]
    runs-on: self-hosted
    strategy:
      matrix:
        itest: ${{ fromJSON(needs.integration-test-matrix.outputs.itest) }}
    steps:
      - name: Cancel previous runs
        uses: styfle/cancel-workflow-action@b173b6ec0100793626c2d9e6b90435061f4fc3e5 # v0.11.0
        with:
          access_token: ${{ github.token }}

      - name: Free Disk Space (Ubuntu)
        if: ${{ runner.environment == 'github-hosted' }}
        uses: jlumbroso/free-disk-space@54081f138730dfa15788a46383842cd2f914a1be # v1.3.1
        with:
          tool-cache: false

      - name: Checkout
        uses: actions/checkout@v4

      - name: Install updates and dependencies
        run: .github/install-deps.sh

      - name: Set rust version via common env file
        run: cat .github/env >> $GITHUB_ENV

      - name: Install stable toolchain
        uses: dtolnay/rust-toolchain@master
        with:
          targets: "wasm32v1-none"
          components: "rust-src"
          toolchain: "${{env.RUST_STABLE_VERSION}}"

      - name: Fetch cache
        uses: Swatinem/rust-cache@f0deed1e0edfc6a9be95417288c0e1099b1eeec3 # v2.7.7
        with:
          shared-key: "fellowship-cache-integration-tests"
          save-if: ${{ github.ref == 'refs/heads/main' }}

      - name: Test ${{ matrix.itest.name }}
        run: cargo test -p ${{ matrix.itest.package }} --release --locked -q
        env:
          RUSTFLAGS: "-C debug-assertions -A warnings" # FAIL-CI AHM

  # Job required by "confirmTestPassed"
  build-chain-spec-generator:
    runs-on: self-hosted
    steps:
      - name: Cancel previous runs
        uses: styfle/cancel-workflow-action@b173b6ec0100793626c2d9e6b90435061f4fc3e5 # v0.11.0
        with:
          access_token: ${{ github.token }}

      - name: Free Disk Space (Ubuntu)
        if: ${{ runner.environment == 'github-hosted' }}
        uses: jlumbroso/free-disk-space@54081f138730dfa15788a46383842cd2f914a1be # v1.3.1
        with:
          tool-cache: false

      - name: Checkout
        uses: actions/checkout@v4

      - name: Install updates and dependencies
        run: .github/install-deps.sh

      - name: Set rust version via common env file
        run: cat .github/env >> $GITHUB_ENV

      - name: Install stable toolchain
        uses: dtolnay/rust-toolchain@master
        with:
          targets: "wasm32v1-none"
          components: "rust-src"
          toolchain: "${{env.RUST_STABLE_VERSION}}"

      - name: Fetch cache
        uses: Swatinem/rust-cache@f0deed1e0edfc6a9be95417288c0e1099b1eeec3 # v2.7.7
        with:
          shared-key: "fellowship-cache-chain-spec-tests"
          save-if: ${{ github.ref == 'refs/heads/main' }}

      - name: Check
        run: cargo check -p chain-spec-generator --release --locked -q --features=all-runtimes
        env:
          RUSTFLAGS: "-C debug-assertions -A warnings" # FAIL-CI AHM
          SKIP_WASM_BUILD: 1

  # Job required by "confirmTestPassed"
  zombienet-smoke:
    runs-on: self-hosted
    steps:
      - name: Cancel previous runs
        uses: styfle/cancel-workflow-action@b173b6ec0100793626c2d9e6b90435061f4fc3e5 # v0.11.0
        with:
          access_token: ${{ github.token }}

      - name: Free Disk Space (Ubuntu)
        if: ${{ runner.environment == 'github-hosted' }}
        uses: jlumbroso/free-disk-space@54081f138730dfa15788a46383842cd2f914a1be # v1.3.1
        with:
          tool-cache: false

      - name: Checkout
        uses: actions/checkout@v4

      - name: Install updates and dependencies
        run: .github/install-deps.sh

      - name: Set rust version via common env file
        run: cat .github/env >> $GITHUB_ENV

      - name: Install stable toolchain
        uses: dtolnay/rust-toolchain@master
        with:
          targets: "wasm32v1-none"
          components: "rust-src"
          toolchain: "${{env.RUST_STABLE_VERSION}}"

      - name: Fetch cache
        uses: Swatinem/rust-cache@f0deed1e0edfc6a9be95417288c0e1099b1eeec3 # v2.7.7
        with:
          shared-key: "fellowship-cache-zombienet-tests"
          save-if: ${{ github.ref == 'refs/heads/main' }}

      - name: Build
        run: |
          cargo build -p chain-spec-generator --no-default-features --features fast-runtime,polkadot,coretime-polkadot --release --locked

      - name: Wait for Docker to Start
        run: |
          timeout 30 sh -c 'until docker info; do sleep 1; done'
          docker --version

      - name: Zombienet smoke test
        timeout-minutes: 20
        run: |
          # Since we are running the runner in a dind environment we need to find the ip
          # of the proxy where the ports will be exposed.
          # In the current infra there are 2 containes, the `dind` and the runner.
          export ZOMBIE_LOCAL_IP=$(hostname -i | awk -F"." '{printf "%d.%d.%d.%d", $1, $2, $3, $4 - 1}')
          export PATH=$(pwd)/target/release:$PATH
          cargo test --manifest-path integration-tests/zombienet/Cargo.toml

  build-runtimes:
    needs: [ runtime-matrix ]
    runs-on: self-hosted
    strategy:
      # Ensure the other jobs are continue
      fail-fast: false
      matrix:
        runtime: ${{ fromJSON(needs.runtime-matrix.outputs.runtime) }}
    steps:
      - name: Free Disk Space (Ubuntu)
        if: ${{ runner.environment == 'github-hosted' }}
        uses: jlumbroso/free-disk-space@54081f138730dfa15788a46383842cd2f914a1be # v1.3.1
        with:
          tool-cache: false

      - name: Checkout sources
        uses: actions/checkout@v4

      - name: Set rust version via common env file
        run: cat .github/env >> $GITHUB_ENV

      - name: Install stable toolchain
        uses: dtolnay/rust-toolchain@master
        with:
          targets: "wasm32v1-none"
          components: "rust-src"
          toolchain: "${{env.RUST_STABLE_VERSION}}"

      - name: Fetch cache
        uses: Swatinem/rust-cache@f0deed1e0edfc6a9be95417288c0e1099b1eeec3 # v2.7.7
        with:
          shared-key: "fellowship-cache-build-runtimes-test"
          save-if: ${{ github.ref == 'refs/heads/main' }}

      - name: Build runtime ${{ matrix.runtime.name }}
        run: |
          PACKAGE_NAME=${{ matrix.runtime.package }}
          RUNTIME_BLOB_NAME=$(echo $PACKAGE_NAME | sed 's/-/_/g').compact.compressed.wasm
          RUNTIME_BLOB_PATH=./target/production/wbuild/$PACKAGE_NAME/$RUNTIME_BLOB_NAME
          # Build wasm
          echo "Building wasm RUNTIME_BLOB_PATH=$RUNTIME_BLOB_PATH"

          FEATURES=""
          # Find out if the `metadata-hash` feature exists for the given package.
          if cargo metadata --format-version=1 | jq '.packages[] | select(.name=="${{ matrix.runtime.package }}") | .features' | grep metadata-hash; then
            FEATURES="metadata-hash"
          fi

          # Add extra features
          if [ -n "${{ matrix.runtime.build_extra_features }}" ]; then
            if [ -z "$FEATURES" ]; then
              FEATURES="${{ matrix.runtime.build_extra_features }}"
            else
              FEATURES="$FEATURES,${{ matrix.runtime.build_extra_features }}"
            fi
          fi

          if [ -n "$FEATURES" ]; then
            FEATURES="--features=$FEATURES"
          fi

          # We only enable `metadata-hash`, but not `on-chain-release-build` to still have logs enabled.
          echo "Setting features: ${FEATURES}"
          cargo build --profile production -p ${{ matrix.runtime.package }} $FEATURES -q --locked
          echo "RUNTIME_BLOB_PATH=$RUNTIME_BLOB_PATH" >> $GITHUB_ENV

      - name: Upload  ${{ matrix.runtime.name }}
        uses: actions/upload-artifact@v4
        with:
          name: ${{ matrix.runtime.name }}
          path: ${{ env.RUNTIME_BLOB_PATH }}

  check-runtimes:
    needs: [ runtime-matrix, build-runtimes ]
    runs-on: ubuntu-latest
    strategy:
      matrix:
        runtime: ${{ fromJSON(needs.runtime-matrix.outputs.runtime) }}
    steps:
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 'node'

      - name: Download ${{ matrix.runtime.name }} WASM artifact
        uses: actions/download-artifact@v4
        with:
          name: ${{ matrix.runtime.name }}

      - name: Check runtime
        timeout-minutes: 10
        env:
          RUNTIME_NAME: ${{ matrix.runtime.name }}
          URIS_JSON: ${{ toJSON(matrix.runtime.uris) }}
        run: |
          # Skip runtimes without URIs (e.g. glutton-kusama)
          if [ "$URIS_JSON" = "null" ] || [ -z "$URIS_JSON" ]; then
            echo "::notice::Skipping $RUNTIME_NAME â€” no URIs configured"
            exit 0
          fi

          WASM=$(find . -name '*.compact.compressed.wasm' -print -quit)
          echo "WASM: $WASM"

          # Try each RPC with a timeout to handle unreachable endpoints
          # (check-runtime hangs indefinitely on unreachable RPCs).
          readarray -t URIS < <(echo "$URIS_JSON" | jq -r '.[]')
          for URI in "${URIS[@]}"; do
            echo "Trying $URI..."
            set +e
            timeout 60 npx @polkadot-api/check-runtime@latest problems "$URI" --wasm "$WASM"
            EXIT_CODE=$?
            set -e
            if [ $EXIT_CODE -eq 0 ]; then
              exit 0
            # When the time limit is reached, timeout returns exit code 124
            elif [ $EXIT_CODE -eq 124 ]; then
              echo "Timed out on $URI, trying next..."
              continue
            else
              # Otherwise, it returns the exit status of the managed command
              exit $EXIT_CODE
            fi
          done

          echo "::error::No reachable RPC for $RUNTIME_NAME"
          exit 1

  ecosystem-tests:
    name: "PET (${{ matrix.network.name }})"
    needs: [build-runtimes]
    runs-on: self-hosted
    timeout-minutes: 120
    if: github.event_name == 'pull_request'
    strategy:
      fail-fast: false
      matrix:
        network:
          - name: "polkadot"
            test_dir: "packages/polkadot"
            chains:
              - { config: "polkadot.yml", port: 9000, endpoint_var: "POLKADOT_ENDPOINT" }
              - { config: "asset-hub-polkadot.yml", port: 9001, endpoint_var: "ASSETHUBPOLKADOT_ENDPOINT" }
              - { config: "bridge-hub-polkadot.yml", port: 9002, endpoint_var: "BRIDGEHUBPOLKADOT_ENDPOINT" }
              - { config: "collectives-polkadot.yml", port: 9003, endpoint_var: "COLLECTIVESPOLKADOT_ENDPOINT" }
              - { config: "coretime-polkadot.yml", port: 9004, endpoint_var: "CORETIMEPOLKADOT_ENDPOINT" }
              - { config: "people-polkadot.yml", port: 9005, endpoint_var: "PEOPLEPOLKADOT_ENDPOINT" }
          - name: "kusama"
            test_dir: "packages/kusama"
            chains:
              - { config: "kusama.yml", port: 9010, endpoint_var: "KUSAMA_ENDPOINT" }
              - { config: "asset-hub-kusama.yml", port: 9011, endpoint_var: "ASSETHUBKUSAMA_ENDPOINT" }
              - { config: "bridge-hub-kusama.yml", port: 9012, endpoint_var: "BRIDGEHUBKUSAMA_ENDPOINT" }
              - { config: "coretime-kusama.yml", port: 9013, endpoint_var: "CORETIMEKUSAMA_ENDPOINT" }
              - { config: "people-kusama.yml", port: 9014, endpoint_var: "PEOPLEKUSAMA_ENDPOINT" }
    steps:
      - name: Free Disk Space (Ubuntu)
        if: ${{ runner.environment == 'github-hosted' }}
        uses: jlumbroso/free-disk-space@54081f138730dfa15788a46383842cd2f914a1be # v1.3.1
        with:
          tool-cache: false

      - name: Checkout sources
        uses: actions/checkout@v4

      - name: Install updates and dependencies
        run: .github/install-deps.sh

      - name: Set rust version via common env file
        run: cat .github/env >> $GITHUB_ENV

      - name: Install stable toolchain
        uses: dtolnay/rust-toolchain@master
        with:
          targets: "wasm32v1-none"
          components: "rust-src"
          toolchain: "${{env.RUST_STABLE_VERSION}}"

      - name: Install Subway
        run: cargo install --git https://github.com/AcalaNetwork/subway

      - name: Start all Subway instances
        run: |
          echo "Starting all Subway instances for ${{ matrix.network.name }}..."

          # Start each subway instance
          echo '${{ toJSON(matrix.network.chains) }}' | jq -c '.[]' | while read chain; do
            CONFIG=$(echo $chain | jq -r '.config')
            PORT=$(echo $chain | jq -r '.port')

            echo "Starting Subway for $CONFIG on port $PORT..."
            sed "s/{{PORT}}/$PORT/g" .github/subway-configs/$CONFIG > /tmp/subway-$PORT.yml
            subway --config /tmp/subway-$PORT.yml > /tmp/subway-$PORT.log 2>&1 &
            echo $! >> /tmp/subway.pids
          done

          # Wait for all subways to start
          echo "Waiting for all Subway instances to start..."
          echo '${{ toJSON(matrix.network.chains) }}' | jq -c '.[]' | while read chain; do
            PORT=$(echo $chain | jq -r '.port')
            timeout=60
            elapsed=0
            while [ $elapsed -lt $timeout ]; do
              if curl -sf http://127.0.0.1:$PORT/health > /dev/null 2>&1; then
                echo "Subway on port $PORT started successfully!"
                break
              fi
              sleep 1
              elapsed=$((elapsed + 1))
            done

            if [ $elapsed -ge $timeout ]; then
              echo "Timeout waiting for subway on port $PORT"
              cat /tmp/subway-$PORT.log
              exit 1
            fi
          done

          echo "All Subway instances started successfully!"

      - name: Download WASM artifacts
        uses: actions/download-artifact@v4
        with:
          merge-multiple: true

      - name: Setup endpoint and runtime overrides
        run: |
          # Set all subway endpoint environment variables
          echo '${{ toJSON(matrix.network.chains) }}' | jq -c '.[]' | while read chain; do
            ENDPOINT_VAR=$(echo $chain | jq -r '.endpoint_var')
            PORT=$(echo $chain | jq -r '.port')
            echo "${ENDPOINT_VAR}=ws://localhost:${PORT}" >> $GITHUB_ENV
          done

          # Set runtime WASM overrides
          jq --raw-output '.[] | .name, .package' .github/workflows/runtimes-matrix.json | while read -r NAME && read -r PACKAGE; do
            NAME="$(echo $NAME | tr -d '-' | tr '[:lower:]' '[:upper:]')"
            RUNTIME_BLOB_NAME=$(echo $PACKAGE | sed 's/-/_/g').compact.compressed.wasm
            echo "Setting runtime override ${NAME}_WASM=$(pwd)/${RUNTIME_BLOB_NAME}"
            echo "${NAME}_WASM=$(pwd)/${RUNTIME_BLOB_NAME}" >> $GITHUB_ENV
          done

      - name: Use latest Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 'node'

      - name: Enable Corepack for Yarn Berry
        run: |
          npm install --global corepack
          corepack enable

      - name: Checkout polkadot-ecosystem-tests
        uses: actions/checkout@v4
        with:
          repository: open-web3-stack/polkadot-ecosystem-tests
          path: ecosystem-tests

      - name: Install test dependencies
        working-directory: ecosystem-tests
        run: yarn install --immutable

      - name: Print environment variables
        run: |
          echo "=== Injected Environment Variables ==="
          env | grep -E "ENDPOINT=|_WASM=" | sort || true
          echo "======================================"

      - name: Update known good block numbers
        working-directory: ecosystem-tests
        run: |
          yarn update-known-good ${{ matrix.network.name }}

      - name: Run ${{ matrix.network.name }} ecosystem tests
        working-directory: ecosystem-tests
        run: |
          echo "Finding Fellowship runtime test files in ${{ matrix.network.test_dir }}..."
          # Only run tests for chains that have a local Subway proxy (i.e. a *_ENDPOINT env var set).
          # External parachains (bifrost, acala, hydration, ...) never have endpoint vars set, so
          # they are excluded automatically â€” no hard-coded allowlist/denylist needed.
          TEST_FILES=$(find ${{ matrix.network.test_dir }} -name "*.e2e.test.ts" | \
            while IFS= read -r f; do
              chain=$(basename "$f" | cut -d. -f1)
              envvar=$(echo "$chain" | tr '[:lower:]' '[:upper:]')_ENDPOINT
              [ -n "${!envvar}" ] && echo "$f"
            done | tr '\n' ' ')

          if [ -z "$TEST_FILES" ]; then
            echo "No test files found in ${{ matrix.network.test_dir }}"
            exit 0
          fi

          echo "Running tests with limited parallelism..."
          # Notes on flags below:
          # 1. `-u` updates snapshots so that they don't fail spuriously e.g. proof size/ref time changes
          # 2. `--pool=threads` runs test files from `$TEST_FILES` in parallel using worker threads. Default
          #    is `--pool=forks`, which uses child processes - heavier.
          # 3. `--maxWorkers=3` combined with the above means at most 3 test files running concurrently, each in its
          #    own thread
          # 4. `--retry=3` attempts a failing test 3 times. This operates at the level of individual tests, not modules,
          #    or the whole test suite; one failure will *not* require a full rerun.
          yarn test -u $TEST_FILES --pool=threads --maxWorkers=3 --retry=3

      - name: Cleanup all Subway instances
        if: always()
        run: |
          if [ -f /tmp/subway.pids ]; then
            echo "Stopping all subway instances..."
            cat /tmp/subway.pids | xargs kill || true
          fi

          # Print logs for debugging
          for log in /tmp/subway-*.log; do
            if [ -f "$log" ]; then
              echo "=== $log ==="
              cat "$log" || true
            fi
          done

  # This will only run if all the tests in its "needs" array passed.
  # Add this as your required job, becuase if the matrix changes size (new things get added)
  # it will still require all the steps to succeed.
  # If you add more jobs, remember to add them to the "needs" array.
  confirmTestPassed:
    runs-on: ubuntu-24.04
    name: All tests passed
    # If any new job gets added, be sure to add it to this list
    needs:
      - runtime-test
      - integration-test
      - build-chain-spec-generator
      - zombienet-smoke
      # PET tests are *still* run and can still provide a degree of confidence, but they are not required.
      # If the runtimes being tested against have breaking changes (removed extrinsics, added/changed/removed call
      # params), false negatives will occur. See #1078 .
      #- ecosystem-tests
    steps:
      - run: echo '### Good job! All the tests passed ðŸš€' >> $GITHUB_STEP_SUMMARY
